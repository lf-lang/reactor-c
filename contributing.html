<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>reactor-c: Contributing</title>
<link rel="icon" href="favicon.ico" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">reactor-c<span id="projectnumber">&#160;1.0</span>
   </div>
   <div id="projectbrief">C Runtime for Lingua Franca</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('contributing.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Contributing </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Contributions to <span class="tt">reactor-c</span> are welcome as long as they conform with the programming style, include tests, and can be released open-source with <a href="https://github.com/lf-lang/reactor-c/blob/main/LICENSE.md">BSD licence</a>.</p>
<dl class="section note"><dt>Note</dt><dd>This document contains guidelines specific to this repository. Please also read the general <a href="https://github.com/lf-lang/.github/blob/main/CONTRIBUTING.md">contributing guidelines</a> of the lf-lang organization.</dd></dl>
<h2 class="doxsection"><a class="anchor" id="autotoc_md3"></a>
Workflow</h2>
<p>All code contributions must go through a <a href="https://github.com/lf-lang/.github/blob/main/CONTRIBUTING.md#pull-requests">pull request (PR)</a>, pass all tests run in CI, and get an approving review before it is merged. Pushing to the <span class="tt">main</span> branch is restricted. All code review is conducted using the Github review system on PRs. Before requesting a code review, ensure that you have:</p>
<ul>
<li>applied the <a class="el" href="#code-style-and-formatting">code formatter</a>;</li>
<li><a class="el" href="#docs">documented</a> your code;</li>
<li>written <a class="el" href="#tests">tests</a> that cover your code; and</li>
<li>accompanied any remaining <span class="tt">TODO</span>s or <span class="tt">FIXME</span>s with a link to an active issue.</li>
</ul>
<p><a class="anchor" id="docs"></a></p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md4"></a>
Documentation</h2>
<p>This repository uses <a href="https://doxygen.org">Doxygen</a> to generate online documentation from source files. It uses <a href="https://en.wikipedia.org/wiki/Javadoc">Javadoc</a>-style documentation with <a href="https://en.wikipedia.org/wiki/Markdown">Markdown</a> supported in the comment bodies.</p>
<p>To build the documentation on your local machine, in a clone of the <a href="https://github.com/lf-lang/reactor-c">reactor-c repository</a>, simply run</p>
<div class="fragment"><div class="line">make docs</div>
</div><!-- fragment --><p> (Running <span class="tt">make</span> with no arguments will list available targets.)</p>
<p>The documentation conventions are:</p>
<ol type="1">
<li>Functions are documented in <span class="tt">.h</span> files. Documentation appears in <span class="tt">.c</span> files only if there is no declaration for the function in a <span class="tt">.h</span> file. Do not duplicate the documentation in both places.</li>
<li>Not all files are included in the Doxygen generation. Which files are included is defined by the <span class="tt">INPUT</span> variable in <a href="https://github.com/lf-lang/reactor-c/blob/main/docs/Doxyfile.in">docs/Doxyfile.in</a>.</li>
<li><p class="startli">Each source file include in the documentation should begin with documentation having the following form:</p>
<div class="fragment"><div class="line">/**</div>
<div class="line"> * @file &lt;filename&gt;</div>
<div class="line"> * @author &lt;first and last name, no email&gt;</div>
<div class="line"> * @author &lt;second author ...&gt;</div>
<div class="line"> * @brief &lt;brief description of the file&gt;</div>
<div class="line"> *</div>
<div class="line"> * &lt;Longer, multi-line description of the file, after a blank line&gt;</div>
<div class="line"> */</div>
</div><!-- fragment --></li>
<li><p class="startli">Each function should be documented using the following pattern:</p>
<div class="fragment"><div class="line">/**</div>
<div class="line"> * @brief &lt;brief description of the function&gt;</div>
<div class="line"> * @ingroup &lt;group name, optional, see below&gt;</div>
<div class="line"> *</div>
<div class="line"> * &lt;Longer, multi-line description of the function, after a blank line&gt;</div>
<div class="line"> * @param &lt;param name&gt; &lt;description&gt;</div>
<div class="line"> * @param &lt;param name&gt; &lt;description&gt;</div>
<div class="line"> * @return &lt;description of return value, optional&gt;</div>
<div class="line"> */</div>
</div><!-- fragment --></li>
</ol>
<p><a class="anchor" id="groups"></a></p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md5"></a>
Groups</h3>
<p>When a function's doc includes an <span class="tt">@ingroup</span> tag, then it will be listed the "Topics" section of the documentation. Otherwise, it will only appear in the "Files" section (which is harder to navigate). The defined topics are:</p>
<ul>
<li><b>API</b>: For macros and functions that are used in reaction bodies and require no <span class="tt">#include</span>.</li>
<li><b>Types</b>: Basic type and struct definitions that may be used in reaction bodies.</li>
<li><b>Constants</b>: Macros for constants such as time values.</li>
<li><b>Utilities</b>: Utility functions and data types.</li>
<li><b>Platform</b>: Functions with platform-specific implementations.</li>
<li><b>Internal</b>: Functions and types used in the runtime system.</li>
<li><b>Federated</b>: Functions used in federated execution.</li>
</ul>
<p>The groups are defined in the file <a href="https://github.com/lf-lang/reactor-c/blob/main/docs/doxygen.h">docs/doxygen.h</a>.</p>
<p><a class="anchor" id="tests"></a></p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md6"></a>
Tests</h2>
<h3 class="doxsection"><a class="anchor" id="autotoc_md7"></a>
System Tests</h3>
<p>System tests are Lingua Franca programs that either compile and run to completion (the test passes) or fail to compile or exit the run with an error condition (returning non-zero). System tests are defined in the <a href="https://github.com/lf-lang/lingua-franca/tree/master/test/C">test/C directory</a> of the lingua-franca repo.</p>
<p>The Github Actions tests for this repo will automatically run all the C Lingua Franca tests with each of the available schedulers and with both the C and CCpp target specified. The version of the lingua-franca repo that is used to do this is specified by the <a href="lingua-franca-ref.txt">lingua-franca-ref.txt</a> file in this directory. Normally, this should point to <span class="tt">master</span>, but to run tests temporarily with a branch of the code generator, just change <a href="lingua-franca-ref.txt">lingua-franca-ref.txt</a> to point to your branch.</p>
<p>To run the system tests locally on your machine, check out the lingua-franca repository and replace the reactor-c submodule with your branch:</p>
<div class="fragment"><div class="line">git clone git@github.com:lf-lang/lingua-franca.git</div>
<div class="line">git submodule update --init --recursive</div>
<div class="line">cd lingua-franca/core/src/main/resources/lib/c/reactor-c/</div>
<div class="line">git checkout &lt;your-branch-name&gt;</div>
</div><!-- fragment --><p>Then follow the <a href="https://github.com/lf-lang/lingua-franca/blob/master/CONTRIBUTING.md">lingua-franca instructions for running tests</a>.</p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md8"></a>
Unit Tests</h3>
<p>To create a new unit test, write a C program with a file name ending in "test.c" in a subdirectory of the <span class="tt">test</span> directory. That file should contain a main and should return 0 if the test succeeds.</p>
<ul>
<li>Tests in the <span class="tt">general</span> subdirectory will always be run.</li>
<li>Tests in the <span class="tt">scheduling</span> subdirectory will be run only if the running platform is Linux and <span class="tt">NUMBER_OF_WORKERS</span> is set to something bigger than 1 (using <span class="tt">-DNUMBER_OF_WORKERS=2</span> as a <span class="tt">cmake</span> parameter). These tests require <span class="tt">sudo</span> permissions.</li>
</ul>
<p>To run tests for the single-threaded runtime, execute the following. Note that <span class="tt">-U</span> is required to undefine a name that may be cached from a previous run.</p>
<div class="fragment"><div class="line">rm -rf build &amp;&amp; mkdir build &amp;&amp; cd build</div>
<div class="line">cmake .. -UNUMBER_OF_WORKERS</div>
<div class="line">cmake --build .</div>
<div class="line">make test</div>
</div><!-- fragment --><p>To run the scheduling tests on a Linux platform, provide a nonzero number of workers when invoking <span class="tt">cmake</span> and use <span class="tt">sudo</span>. For example, in the <span class="tt">build</span> directory:</p>
<div class="fragment"><div class="line">cmake .. -DNUMBER_OF_WORKERS=2</div>
<div class="line">cmake --build .</div>
<div class="line">sudo make test</div>
</div><!-- fragment --><p>One of the tests requires sudo because it changes the scheduling policy and priorities.</p>
<p>To define/undefine other preprocessor definitions such as <span class="tt">LOG_LEVEL</span>, pass them as arguments to <span class="tt">cmake</span> in the same way as with <span class="tt">NUMBER_OF_WORKERS</span>, using the same <span class="tt">-D</span>/<span class="tt">-U</span> prefixes.</p>
<p><a class="anchor" id="code-style-and-formatting"></a></p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md9"></a>
Code style and formatting</h2>
<p>We use clang-format to format our codebase. To run the formatter on all source and header files in reactor-c:</p>
<div class="fragment"><div class="line">make format</div>
</div><!-- fragment --><p> The CI will do a "dry-run" of the formatter to verify that all files are correctly formatted and will indicate errors if not.</p>
<p>VSCode can be configured to run clang-format on files as they are saved. To achieve this set the following settings:</p>
<ul>
<li>editor.formatOnSave: true</li>
<li>C_Cpp.formatting: clang-format</li>
<li>C_Cpp.clang_format_style: file</li>
</ul>
<h3 class="doxsection"><a class="anchor" id="autotoc_md10"></a>
General guidelines</h3>
<ul>
<li><em>Do not copy-paste code.</em> If you want to reuse code, factor it out into a method and call it.</li>
<li><em>Keep functions concise.</em> As a rule of thumb, a function should fit on your screen so that it can be read without scrolling. We impose no hard limit on method length, but anything above 40 lines should be considered for breaking up.</li>
<li><em>Do not leave FIXMEs</em>. Unaddressed <span class="tt">FIXME</span>s should not be allowed to pass code review unless they are accompanied with a link to a GitHub issue.</li>
</ul>
<p><em>Comments</em></p>
<p>Please adhere to the following principles when writing documentation for your code:</p>
<ul>
<li>Use <a href="https://www.doxygen.nl/manual/docblocks.html">Doxygen-style comments</a> with <a href="https://www.doxygen.nl/manual/markdown.html">Markdown</a> in the comment bodies.</li>
<li>Write descriptions in English.</li>
<li>Do not use contractions like "aren't" or "isn't".</li>
<li>Use imperative in the description of a function; i.e., write "Compute the shortest path," not "Computes the shortest path" (the latter is not a complete sentence).</li>
<li>In <span class="tt">@param</span> JavaDoc tag descriptions it is OK to use incomplete sentences in the interest of brevity. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on <span class="timestamp"></span> for reactor-c by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
